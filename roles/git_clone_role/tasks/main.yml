---
# Rôle : git_clone_role
# Objectif : cloner / mettre à jour des dépôts Git de manière dynamique

- name: Ne rien faire si git_clone_role_manage est à false
  ansible.builtin.debug:
    msg: "git_clone_role_manage est à false : le rôle ne gère aucun dépôt."
  when: not git_clone_role_manage
  tags: [git_clone]

# 1. Message si la liste est vide
- name: Aucun dépôt Git à gérer
  ansible.builtin.debug:
    msg: "git_clone_role_repos est vide : aucun dépôt à cloner/mettre à jour."
  when:
    - git_clone_role_manage
    - git_clone_role_repos | length == 0
  tags: [git_clone]

# 2. Cloner / mettre à jour les dépôts
- name: Cloner / mettre à jour les dépôts Git définis
  ansible.builtin.git:
    repo: "{{ item.repo }}"
    dest: "{{ item.dest }}"
    version: "{{ item.version | default('HEAD') }}"
    accept_hostkey: "{{ item.accept_hostkey | default(false) }}"
    force: "{{ item.force | default(false) }}"
    update: "{{ item.update | default(true) }}"
    clone: "{{ item.clone | default(true) }}"
    key_file: "{{ item.key_file | default(omit) }}"
    bare: "{{ item.bare | default(omit) }}"
    depth: "{{ item.depth | default(omit) }}"
  loop: "{{ git_clone_role_repos }}"
  loop_control:
    label: "{{ item.dest }}"
  when:
    - git_clone_role_manage
    - git_clone_role_repos | length > 0
  tags: [git_clone]