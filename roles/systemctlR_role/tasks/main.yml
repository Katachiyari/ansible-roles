---
# Rôle : systemctlR_role
# Objectif : gérer les services via systemd (start/stop/restart/reload/daemon-reload)

- name: Ne rien faire si systemctlR_role_manage est à false
  ansible.builtin.debug:
    msg: "systemctlR_role_manage est à false : aucune gestion de services exécutée."
  when: not systemctlR_role_manage
  tags: [systemctlR, services]

############################################################
# 1. Optionnel : daemon-reload global
############################################################

- name: Exécuter un 'systemctl daemon-reload' global
  ansible.builtin.systemd:
    daemon_reload: true
  when:
    - systemctlR_role_manage
    - systemctlR_role_global_daemon_reload
  tags: [systemctlR, daemon_reload]

############################################################
# 2. Message si aucune action de service
############################################################

- name: Aucun service à gérer
  ansible.builtin.debug:
    msg: "systemctlR_role_services est vide : aucun service à start/stop/restart/reload."
  when:
    - systemctlR_role_manage
    - systemctlR_role_services | length == 0
  tags: [systemctlR, services]

############################################################
# 3. Gérer chaque service
############################################################

- name: Gérer les services déclarés dans systemctlR_role_services
  ansible.builtin.include_tasks: manage_one.yml
  loop: "{{ systemctlR_role_services }}"
  loop_control:
    loop_var: system_item
    label: "{{ system_item.name }}"
  when:
    - systemctlR_role_manage
    - systemctlR_role_services | length > 0
  tags: [systemctlR, services]