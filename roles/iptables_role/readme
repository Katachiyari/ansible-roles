---
- name: Appliquer des règles iptables personnalisées
  hosts: all
  become: yes

  roles:
    - role: iptables_role
      vars:
        iptables_rules:
          - "-A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT"
          - "-A INPUT -p tcp --dport 22 -j ACCEPT"
          - "-A INPUT -p tcp --dport 80 -j ACCEPT"
          - "-A INPUT -p tcp --dport 443 -j ACCEPT"
          - "-A INPUT -j DROP"
        iptables_persistent: true
        iptables_save_file: "/etc/iptables/rules.v4"
