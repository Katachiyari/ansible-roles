---
- name: Appliquer des règles iptables personnalisées
  hosts: all
  become: yes

  roles:
    - role: iptables_role
      vars:
        iptables_rules:
          - "-A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT"
          - "-A INPUT -p tcp --dport 22 -j ACCEPT"
          - "-A INPUT -j DROP"
        iptables_persistent: true

# Ce rôle applique des règles iptables via iptables-restore, installe iptables-persistent et conserve les règles.
# Il permet de définir des règles personnalisées et d’activer la persistance des règles au redémarrage.