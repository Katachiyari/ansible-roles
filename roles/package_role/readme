---
- name: Exemple avancé d'utilisation de package_role
  hosts: all
  become: true

  vars:
    package_role_manage: true

    package_role_items:
      # 1. Installer des outils de base (gestion auto du manager)
      - name:
          - curl
          - vim
          - git
        state: present
        update_cache: true

      # 2. S'assurer que 'telnet' est supprimé
      - name: telnet
        state: absent

      # 3. Installer nginx (avec options apt/yum selon OS)
      - name: nginx
        state: present
        update_cache: true

      # 4. Exemple avancé RedHat : installer httpd depuis un repo spécifique
      - name: httpd
        state: latest
        manager: yum
        enablerepo: "epel"
        disablerepo: "some-old-repo"

      # 5. Fallback ou mix possible
      - name: htop
        state: present

  roles:
    - role: package_role

    ######################################################################################
    A. Utilisation minimale (juste des paquets à installer)
YAML
vars:
  package_role_items:
    - name:
        - curl
        - wget
        - git
Ici :

pas de state → present par défaut,
pas de manager → auto selon l’OS,
pas de update_cache → false par défaut.
######################################################################################
B. Rôle présent dans le playbook mais désactivé dans un environnement
YAML
vars:
  package_role_manage: false
  package_role_items:
    - name: nginx
      state: present

roles:
  - role: package_role
Le rôle ne fait qu’afficher un message et ne modifie rien.
######################################################################################
C. Cas OS mixte : même playbook pour Debian et RedHat
Tu peux lancer le même playbook sur un inventaire qui contient :

des hôtes Debian,
des hôtes RedHat.
Le package_role :

sur Debian → utilisera apt,
sur RedHat → utilisera yum,
avec la même définition de package_role_items.